var a=27.5,asharp=29.1352,b=30.8677,bflat=asharp,c=32.7032,csharp=34.6478,d=36.7081,dflat=csharp,dsharp=38.8909,e=41.2034,eflat=dsharp,f=43.6535,fsharp=46.2493,g=48.9994,gflat=fsharp,gsharp=51.9131,aflat=gsharp,frequency={rest:0,a0:a,a1:2*a,a2:4*a,a3:8*a,a4:16*a,a5:32*a,a6:64*a,a7:128*a,b0:b,b1:2*b,b2:4*b,b3:8*b,b4:16*b,b5:32*b,b6:64*b,b7:128*b,c1:c,c2:2*c,c3:4*c,c4:8*c,c5:16*c,c6:32*c,c7:64*c,c8:128*c,d1:d,d2:2*d,d3:4*d,d4:8*d,d5:16*d,d6:32*d,d7:64*d,e1:e,e2:2*e,e3:4*e,e4:8*e,e5:16*e,e6:32*e,e7:64*
e,f1:f,f2:2*f,f3:4*f,f4:8*f,f5:16*f,f6:32*f,f7:64*f,g1:g,g2:2*g,g3:4*g,g4:8*g,g5:16*g,g6:32*g,g7:64*g,"a#0":asharp,"a#1":2*asharp,"a#2":4*asharp,"a#3":8*asharp,"a#4":16*asharp,"a#5":32*asharp,"a#6":64*asharp,"a#7":128*asharp,"c#1":csharp,"c#2":2*csharp,"c#3":4*csharp,"c#4":8*csharp,"c#5":16*csharp,"c#6":32*csharp,"c#7":64*csharp,"d#1":dsharp,"d#2":2*dsharp,"d#3":4*dsharp,"d#4":8*dsharp,"d#5":16*dsharp,"d#6":32*dsharp,"d#7":64*dsharp,"f#1":fsharp,"f#2":2*fsharp,"f#3":4*fsharp,"f#4":8*fsharp,"f#5":16*
fsharp,"f#6":32*fsharp,"f#7":64*fsharp,"g#1":gsharp,"g#2":2*gsharp,"g#3":4*gsharp,"g#4":8*gsharp,"g#5":16*gsharp,"g#6":32*gsharp,"g#7":64*gsharp,a_1:aflat,a_2:2*aflat,a_3:4*aflat,a_4:8*aflat,a_5:16*aflat,a_6:32*aflat,a_7:64*aflat,b_0:bflat,b_1:2*bflat,b_2:4*bflat,b_3:8*bflat,b_4:16*bflat,b_5:32*bflat,b_6:64*bflat,b_7:128*bflat,d_1:dflat,d_2:2*dflat,d_3:4*dflat,d_4:8*dflat,d_5:16*dflat,d_6:32*dflat,d_7:64*dflat,e_1:eflat,e_2:2*eflat,e_3:4*eflat,e_4:8*eflat,e_5:16*eflat,e_6:32*eflat,e_7:64*eflat,g_1:gflat,
g_2:2*gflat,g_3:4*gflat,g_4:8*gflat,g_5:16*gflat,g_6:32*gflat,g_7:64*gflat},duration={ts:.03125,s:.0625,"s-dot":.09375,t:.08333,e:.125,"e-dot":.1875,q:.25,"q-dot":.375,h:.5,"h-dot":.75,w:1,"w-dot":1.5},Offbeat={parse_notes:function(h){return h.split(",").map(function(h){return h.trim().split(" ")})},generate_audio:function(h){var l=this,k=this.context.createOscillator(),m=this.calculate_time(duration[this.notesParsed[h][0]]),n=frequency[this.notesParsed[h][1]];k.connect(this.context.destination);
k.type=this.instrument;k.frequency.value=n;k.start(0);k.stop(this.context.currentTime+m);k.onended=function(){h<l.notesParsed.length-1&&!l.isStopped?(h+=1,l.generate_audio(h)):l.normalize()}},calculate_time:function(h){return h*this.beatsPerMeasure/(this.tempo/60)},layer:function(h){var l={tempo:60,timeSig:"4/4",instrument:"sine",notes:""};if(h&&"object"===typeof h)for(var k in h)if(l.hasOwnProperty(k)&&typeof l[k]===typeof h[k])l[k]=h[k];else throw Error('Property "'+k+'" is invalid');h=Object.assign(Object.create(this),
l);h.beatsPerMeasure=parseInt(h.timeSig,10);h.notesParsed=this.parse_notes(h.notes);h.context=new (window.AudioContext||window.webkitAudioContext);h.isStopped=!1;h.isLoop=!1;return h},play:function(){if(""===this.notes)throw Error('Property "notes" is invalid');this.generate_audio(0)},playReverse:function(){this.notesParsed.reverse();this.play()},playLoop:function(){this.isLoop=!0;this.play()},playReverseLoop:function(){this.isLoop=!0;this.playReverse()},stop:function(){this.isStopped=!0;this.isLoop=
!1},time:function(){var h=this;if(""===this.notes)return 0;var l=0;this.notesParsed.forEach(function(k){l+=h.calculate_time(duration[k[0]])});return l},normalize:function(){var h=this;this.context.close().then(function(){h.isLoop?(h.context=new (window.AudioContext||window.webkitAudioContext),h.isStopped=!1,h.play()):(h.context=new (window.AudioContext||window.webkitAudioContext),h.isStopped=!1,h.notesParsed=h.parse_notes(h.notes))})}};module.exports=Offbeat;
